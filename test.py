import logging
import json
from langchain_core.messages import HumanMessage, AIMessage

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

history = {
    'history': [HumanMessage(content='What is your purpose?'), AIMessage(content='My purpose is to analyze sentiment in survey results and detect recurring wordage or phrasing from previous testimonials.'), HumanMessage(content='Here is a survey with the \'_id\': 66063a9e413ebae5dc3ce75e. Please review the survey and confirm that you processed the data: Survey response = {"email": "grant@unlabeledmusic.com", "survey_responses": {"How would you rate the ease of transitioning and implementation to TPC\'s services from your previous payroll provider?": "Easy", "How user-friendly do you find iSolved, TPC\'s HR and payroll software?": "Average", "Who was your previous Payroll Provider?": "ADP", "What field or industry does your company specialize in?": "Photography Services", "How would you rate your satisfaction for TPC over your previous payroll provider?": "Satisfied", "How would you rate your experience with TPC\'s customer service in addressing your inquiries and concerns?": "Very Satisfied", "How many employees does your company currently process payroll for?": "65", "How inclined are you to recommend Grant Stuart and TPC\'s services to another business?": "Somewhat Likely", "Please share your experience or any additional feedback you have regarding your experience with Grant Stuart and TPC.": "Payroll providers have a well deserved reputation for being horrible.  TPC does a pretty good job of working with my specific needs."}}'), AIMessage(content='I have processed the survey data with the following sentiment analysis and recurring wordage detection:\n\nSentiment Analysis:\n- Ease of transitioning and implementation to TPC\'s services: Positive\n- User-friendliness of iSolved software: Neutral\n- Satisfaction with TPC over previous payroll provider: Positive\n- Experience with TPC\'s customer service: Very Positive\n- Likelihood to recommend TPC\'s services: Neutral\n\nRecurring Wordage:\n- "TPC" is mentioned multiple times throughout the survey responses.\n- The term "payroll provider" is used in both positive and negative contexts.\n- The phrase "specific needs" is highlighted in the additional feedback section.\n\nIf you have any further questions or need additional analysis, feel free to ask.'), HumanMessage(content='Before I ask you to generate a testimonial I\'d like you to review these historical testimonial responses for recurring language. Document them and we will avoid using repeat language in our future testimonial generations. Historical Documents = [\'Transitioning to TPC\\\'s services from my previous payroll provider was a breeze, and iSolved\\\'s user-friendly interface has truly simplified HR and payroll tasks for our 160-employee company in the communication industry. The exceptional customer service received left me very satisfied. Bill Welty\\\'s outstanding support truly rocks! I highly recommend TPC and Grant Stuart for their great service and product. Transitioning to TPC\\\'s services from my previous payroll provider was incredibly smooth, making it a seamless switch for our team of 160 employees in the communication industry. iSolved is a breeze to use, simplifying our HR and payroll processes. The outstanding customer service team at TPC has been exceptional, and I am very satisfied with their support. I would highly recommend Grant Stuart and TPC\\\'s services to any business. Bill Welty is a fantastic asset to the team! Transitioning to TPC\\\'s services from my previous payroll provider, (company name) was a breeze. iSolved, TPC\\\'s HR and payroll software, is incredibly user-friendly, making managing HR and payroll for our 160 employees effortless. The satisfaction I\\\'ve experienced with TPC over my former provider is beyond words. The customer service team\\\'s exceptional support in addressing my inquiries and concerns has been outstanding. I am very inclined to recommend Grant Stuart and TPC\\\'s services to other businesses. As for my experience, I must say, "Bill Welty ROCKS!". TPC and Grant Stuart have truly set a new standard in the communication industry.\', \'"The transition to TPC\\\'s services from my previous payroll provider, Paycor, was seamless. iSolved, their HR and payroll software, is intuitive and efficient. Grant Stuart and the TPC team have been responsive and helpful. I highly recommend their services for home healthcare businesses like mine with 50 employees." "I recently transitioned our Home Healthcare company\\\'s payroll services from Paycor to TPC, and it was a seamless process. Grant Stuart provided excellent support throughout. While there were some challenges with customer service, I believe there\\\'s room for improvement. The iSolved software is intuitive and easy to use for our 50 employees. I am inclined to recommend Grant Stuart and TPC\\\'s services to other businesses based on the positive experience overall." To begin with, transitioning to TPC\\\'s services from my previous payroll provider, Paycor, was remarkably seamless. The switch was effortless, and the iSolved HR and payroll software is incredibly intuitive, making my tasks easier. My satisfaction with TPC over Paycor is substantial, and I appreciate the support provided. While my experience with customer service was satisfactory, there is room for improvement to enhance responsiveness. As a company specializing in home healthcare with 50 employees, I am likely to recommend Grant Stuart and TPC\\\'s services to others. Lastly, Grant Stuart\\\'s dedication and commitment are commendable, ensuring a positive impact on our payroll processes.\']'), AIMessage(content="Recurring Language from Historical Testimonials:\n- Transitioning to TPC's services from previous payroll provider: This phrase is consistently used to describe the smooth process of switching to TPC's services.\n- iSolved software: Mentioned as user-friendly and efficient in managing HR and payroll tasks.\n- Customer service: Described as exceptional, outstanding, and supportive in addressing inquiries and concerns.\n- Grant Stuart: Highlighted as providing excellent support and being a valuable asset to the team.\n- Recommendation: Multiple testimonials express a high likelihood of recommending TPC's services to other businesses.\n- Specific industry mentions: Communication industry and home healthcare industry are both referenced in the testimonials.\n\nBy avoiding the reuse of these recurring phrases and focusing on unique aspects of the latest survey response, we can generate a fresh and distinctive testimonial. Let me know if you would like me to proceed with creating a new testimonial based on the survey response provided.")]
}

# Assuming 'history' is a dictionary containing a 'history' key with a list of messages
history_serializable = []

# Iterate over each message in the history
for message in history['history']:
    # Convert HumanMessage objects to dictionaries
    if isinstance(message, HumanMessage):
        message_dict = {'Human': message.content}
        history_serializable.append(message_dict)
    # Convert AIMessage objects to dictionaries
    elif isinstance(message, AIMessage):
        message_dict = {'Ai': message.content}
        history_serializable.append(message_dict)
    # Handle unrecognized message types
    else:
        logger.warning(f"Unrecognized message type: {type(message)}")

# Create the payload dictionary
payload = {'history': history_serializable}

# Convert the payload to JSON format
payload_json = json.dumps(payload)

print(payload_json)
